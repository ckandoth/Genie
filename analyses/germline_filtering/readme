GOAL: With the data provided from each institute, remove as many germline and FP sites as possible

## ------------------- ##
## Check for known FPs ##
## ------------------- ##

# As part of the TCGA PancanAtlas MC3 project, Broad Institute (BI) ran their proprietary Panel of
# Normals (PoN) tool across 8000 TCGA normal exomes, in order to detect germline variant sites, or
# false-positives recurrent in exome-seq generated by the TCGA sequencing centers. Internally, BI
# stores the distribution of variant allele fractions (VAF) at these sites, so they can compare
# that to the VAF of candidate somatic variants. This helps retain true somatic variants at
# germline positions, but unfortunately we don't have access to that level of detail. All we have
# is this list of variants per sample, that are tagged as failing their PoN filter:
# https://tcga-data-secure.nci.nih.gov/tcgafiles/tcgajamboree/tcgajamboree/mc3/broad/pancan.merged.v0.2.pfiltered.broad_pon_tagged_v2.txt.gz

# Downloaded that file, reformatted it from pipe-delim to tab-delim, removed sample IDs, de-
# duplicated by site+allele, and stored it locally at bin/tcga_pancan_broad_pon_fp_tags.tsv.gz

# Make a list of each Genie variant and their FILTER tags, and add Broad's PoN tag if seen above:
# ::NOTE:: This code will get simpler once all the problems with these tags are fixed
perl -a -F'\t' -ne 'BEGIN{%fp=map{chomp; ($_,1)}`bgzip -dc bin/tcga_pancan_broad_pon_fp_tags.tsv.gz`} $k=join("\t",@F[4..6,10,12]); $F[108]=~s/^\.$/PASS/; $F[108]=~s/common_variant,common_variant/common_variant/; $f=($fp{$k}?"Broad_PoN_FP,$F[108]":$F[108]); $f=~s/,PASS$//; print join("\t",$k,$f,@F[2,15,0,36,50])."\n" unless(m/^#/)' ../../data/cbioportal/data_mutations_extended.txt > aacr_genie_filter_tags.tsv

# Summarize the FILTER tags:
cut -f6 aacr_genie_filter_tags.tsv | sort | uniq -c | sort -rn

  84488 PASS
   6223 Broad_PoN_FP,common_variant
   5651 Broad_PoN_FP
   4179 common_variant

# List out the top few recurrent sites tagged as Broad_PoN_FP, but not as common_variant:
grep -w Broad_PoN_FP aacr_genie_filter_tags.tsv | grep -wv common_variant | cut -f1-5,9- | sort | uniq -c | sort -rn | head -n15

487 4       55599436        55599436        T       C       KIT             intron_variant
464 9       80343587        80343588        -       A       GNAQ            splice_region_variant,intron_variant
463 9       80343588        80343588        A       -       GNAQ            splice_region_variant,intron_variant
463 11      108117897       108117898       -       T       ATM             intron_variant
462 22      24145675        24145675        G       C       SMARCB1         intron_variant
382 2       212578379       212578380       -       A       ERBB4           splice_region_variant,intron_variant
214 22      17055458        17055458        G       A       KB-67B5.12              non_coding_transcript_exon_variant,non_coding_transcript_variant
155 2       132181483       132181483       G       T       GNAQP1          non_coding_transcript_exon_variant,non_coding_transcript_variant
100 X       129162905       129162905       T       G       BCORL1          intron_variant
 99 X       15808795        15808795        T       C       ZRSR2           intron_variant
 99 X       129162898       129162898       A       G       BCORL1          intron_variant
 98 17      7579644 7579659 CCCCAGCCCTCCAGGT        -       TP53            intron_variant
 96 13      28607916        28607916        T       A       FLT3            intron_variant
 89 7       148504854       148504855       -       GACTT   EZH2            intron_variant
 86 X       15827524        15827524        T       G       ZRSR2           intron_variant

# It's a good sign that they're all non-coding events; makes it simpler to toss with prejudice.

## ------------------------ ##
## Check for germline sites ##
## ------------------------ ##

# One of the FILTER tags already summarized above is `common_variant`, defined as "If minor allele
# freq is >0.0004 in any ExAC subpopulation, unless ClinVar says pathogenic, risk_factor, or
# protective". Note that the ExAC VCF used by vcf2maf/maf2maf is a subset of release 1.3.1 where
# TCGA normals have been excluded. As well as any known age-related somatic variants resulting from
# clonal expansion in hematopoietic stem cells.

# Summarize those tags across centers:
cut -f6,7 aacr_genie_filter_tags.tsv | grep common_variant | sort | uniq -c | sort -rn

   3561 Broad_PoN_FP,common_variant     NKI
   2037 Broad_PoN_FP,common_variant     VICC
    349 Broad_PoN_FP,common_variant     JHH
    102 Broad_PoN_FP,common_variant     MSK
     87 Broad_PoN_FP,common_variant     UHN
     78 Broad_PoN_FP,common_variant     DFCI
      6 Broad_PoN_FP,common_variant     GRCC
      3 Broad_PoN_FP,common_variant     MDA
   2141 common_variant                  VICC
    723 common_variant                  MSK
    623 common_variant                  NKI
    294 common_variant                  DFCI
    268 common_variant                  JHH
     88 common_variant                  UHN
     23 common_variant                  MDA
     19 common_variant                  GRCC
